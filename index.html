<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smoother Fake Live Playlist</title>
  <script src="https://www.youtube.com/iframe_api"></script>
  <style>
    body { margin:0; background:#000; display:flex; justify-content:center; align-items:center; height:100vh; }
    #player { width:80vw; height:45vw; max-width:1280px; max-height:720px; pointer-events:none; }
  </style>
</head>
<body>
  <div id="player"></div>
  <script>
    const PLAYLIST_ID = "PLVLt7z5PCAkdi6JJjUREV4XKWsb337WHc";
    const API_KEY = "AIzaSyAkqCxO9Un0AwdDGRnPG4b8lZ84GohpKOw";
    const START_TIME = new Date("2025-01-01T00:00:00Z");

    let videoDurations = [];
    let totalDuration = 0;
    let player;
    let currentIndex = -1;

    async function fetchDurations() {
      let allVideoIds = [];
      let nextPageToken = "";

      do {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=contentDetails&maxResults=50&playlistId=${PLAYLIST_ID}&pageToken=${nextPageToken}&key=${API_KEY}`);
        const data = await res.json();
        allVideoIds.push(...data.items.map(i=>i.contentDetails.videoId));
        nextPageToken = data.nextPageToken || "";
      } while(nextPageToken);

      const chunkSize = 50;
      for(let i=0;i<allVideoIds.length;i+=chunkSize){
        const chunk = allVideoIds.slice(i,i+chunkSize).join(",");
        const res = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${chunk}&key=${API_KEY}`);
        const data = await res.json();
        videoDurations.push(...data.items.map(v=>parseISO8601(v.contentDetails.duration)));
      }

      totalDuration = videoDurations.reduce((a,b)=>a+b,0);
    }

    function parseISO8601(d){
      const m=d.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
      return (parseInt(m[1]||0)*3600)+(parseInt(m[2]||0)*60)+(parseInt(m[3]||0));
    }

    function onYouTubeIframeAPIReady(){
      player = new YT.Player("player",{
        playerVars:{listType:"playlist",list:PLAYLIST_ID,autoplay:1,controls:0,disablekb:1,modestbranding:1,rel:0},
        events:{
          onReady: async ()=>{
            await fetchDurations();
            startSync();
            setInterval(forcePlay,1000); 
            document.addEventListener('contextmenu',e=>e.preventDefault());
            document.addEventListener('keydown',e=>e.preventDefault());
          }
        }
      });
    }

    function startSync(){
      setInterval(()=>{
        if(videoDurations.length===0) return;

        const now = new Date();
        let elapsed = Math.floor((now-START_TIME)/1000);
        elapsed = elapsed % totalDuration;

        let index=0;
        while(elapsed>=videoDurations[index]){
          elapsed-=videoDurations[index];
          index=(index+1)%videoDurations.length;
        }

        // switch video if needed
        if(index!==currentIndex){
          currentIndex=index;
          player.playVideoAt(index);
        }

        // only seek if drift > 2 seconds
        const currentTime = player.getCurrentTime();
        if(Math.abs(currentTime - elapsed) > 2){
          player.seekTo(elapsed,true);
        }

      },500); 
    }

    function forcePlay(){
      if(player && player.getPlayerState()!==YT.PlayerState.PLAYING){
        player.playVideo();
      }
    }
  </script>
</body>
</html>
